# Akamai Compute RabbitMQ Deployment One-Click APP

RabbitMQ is a lightweight, open-source message broker that enables reliable communication between distributed systems through advanced queuing and messaging protocols, such as AMQP. It supports message delivery confirmation, routing, and exchange patterns, making it ideal for scalable and fault-tolerant applications.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| RabbitMQ    | Latest    | Message broker |
| Nginx | 1.24.0 | Web server | 


**Supported Distributions:**

- Ubuntu 24.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |
| Certbot | Install SSL certificates for the domain provided during the setup |

## Use our API

Customers can choose to the deploy the RabbitMQ app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- TOKEN
- ROOT_PASS
- USERNAME
- SOA_EMAIL_ADDRESS
- SUBDOMAIN
- DOMAIN
- ALLOWED_IPS_AMQP
- RABBITMQ_ADMIN_USERNAME
- RABBITMQ_USERNAME
- RABBITMQ_VERSION

SHELL:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"
export SOA_EMAIL_ADDRESS="email@domain.com"
export SUBDOMAIN=""
export DOMAIN="example.com"
export ALLOWED_IPS_AMQP=""
export RABBITMQ_ADMIN_USERNAME="admin"
export RABBITMQ_USERNAME="myapp"
export RABBITMQ_VERSION="latest"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "image": "linode/ubuntu24.04",
    "private_ip": true,
    "region": "us-mia",
    "stackscript_data": {
        "user_name": "${USERNAME}",
        "disable_root": "No",
        "token_password": "${TOKEN}",
        "subdomain": "${SUBDOMAIN}",
        "domain": "${DOMAIN}",
        "soa_email_address": "${SOA_EMAIL_ADDRESS}",
        "allowed_ips_amqp": "${ALLOWED_IPS_AMQP}",
        "rabbitmq_admin_username": "${RABBITMQ_ADMIN_USERNAME}",
        "rabbitmq_username": "${RABBITMQ_USERNAME}",
        "rabbitmq_version": "${RABBITMQ_VERSION}"
    },
    "stackscript_id": 688890,
    "type": "g6-dedicated-4",
    "label": "rabbitmq-server",
    "root_pass": "${ROOT_PASS}",
    "authorized_users": [
        "user1"
    ],
    "disk_encryption": "enabled"
}' https://api.linode.com/v4/linode/instances
```

CLI:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"
export SOA_EMAIL_ADDRESS="email@domain.com"
export SUBDOMAIN=""
export DOMAIN="example.com"
export ALLOWED_IPS_AMQP=""
export RABBITMQ_ADMIN_USERNAME="admin"
export RABBITMQ_USERNAME="myapp"
export RABBITMQ_VERSION="latest"

linode-cli linodes create \
  --image 'linode/ubuntu24.04' \
  --private_ip true \
  --region us-mia \
  --stackscript_data '{"user_name": "{USERNAME}","disable_root":"No","token_password":"${TOKEN}","subdomain":"${SUBDOMAIN}","domain":"${DOMAIN}","soa_email_address":"${SOA_EMAIL_ADDRESS}","allowed_ips_amqp":"${ALLOWED_IPS_AMQP}","rabbitmq_admin_username":"${RABBITMQ_ADMIN_USERNAME}","rabbitmq_username":"${RABBITMQ_USERNAME}","rabbitmq_version":"${RABBITMQ_VERSION}"}' \
  --stackscript_id 688890 \
  --type g6-dedicated-4 \
  --label rabbitmq-server \
  --root_pass ${ROOT_PASS} \
  --authorized_users user1 \
  --disk_encryption enabled
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
- [RabbitMQ - Getting Started](https://www.rabbitmq.com/tutorials)