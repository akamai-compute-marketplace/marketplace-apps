---
- name: Create password update script
  template:
    src: update-guacamole-password.sh.j2
    dest: "{{ guacamole_base_dir }}/update-guacamole-password.sh"
    mode: '0755'
    owner: root
    group: root

- name: Set initial Guacamole admin password
  command: ./update-guacamole-password.sh "{{ guacamole_admin_password }}"
  args:
    chdir: "{{ guacamole_base_dir }}"
  register: password_update_result
  failed_when: password_update_result.rc != 0

- name: Display password update result
  debug:
    msg: "Guacamole admin password has been set to: {{ guacamole_admin_password }}"