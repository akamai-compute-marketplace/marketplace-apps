---
# Install Addons if requested
#- name: Add addons
#  import_role:
#    name: addons
#  when: add_ons != ['none']

- name: Restart Apache2
  systemd:
    name: apache2.service
    state: restarted
  when: webserver_stack == 'lamp'

- name: Configuring domain with certbot
  import_role:
    name: certbot_ssl

- name: Moving vhost_ssl template 
  template: 
    src: ../../lemp/templates/vhost_ssl.conf.j2
    dest: "/etc/nginx/sites-available/{{ _domain }}.conf"
    owner: root
    group: root
    mode: 0644 
  when: webserver_stack == 'lemp'

- name: Restart Nginx
  systemd:
    name: nginx.service
    state: restarted
  when: webserver_stack == 'lemp'

# data exporter

- name: Adding prometheus exporters
  import_role:
    name: data_exporter
  when: prometheus_exporter != 'none'

# motd and creds gen
- name: copy MOTD template to /etc/motd
  template:
    src: templates/motd.j2
    dest: /etc/motd

- name: writing sudo creds into file
  copy:
    dest: '/home/{{ username }}/.credentials'
    mode: '0600'
    owner: '{{ username }}'
    group: '{{ username }}'
    content: |
      Sudo Username: {{ username }}
      Sudo Password: {{ password }}
      Mysql root Password: {{ mysql_root_password }}
      Wordpress DB User: {{ wp_db_user }}
      Wordpress DB Password: {{ wp_db_pass }}
      Wordpress Admin User: {{ wp_admin_user }}
      Wordpress Admin Password: {{ wp_admin_pass }}
