# Linode Drupal Deployment One-Click APP

Drupal is a free and open-source content management system (CMS) written in PHP that provides a robust platform for building websites and applications.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| Apache    | 2.4       | Web server |
| MariaDB   | 11.2      | Open source database management system |
| PHP       | 8.3       | Server-side scripting language |
| Drupal    | 10.3.8    | Content Management System |
| Composer  | 2.8.3     | PHP dependency manager |
| Drush     | 13.3.3    | Drupal CLI tool |

**Supported Distributions:**

- Ubuntu 22.04 LTS
- Ubuntu 24.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to the deploy the Drupal app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- TOKEN
- ROOT_PASS

```
SHELL:
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export USERNAME="admin"
export PASSWORD="aComplexP@ssword"
export DOMAIN="example.com"
export SUBDOMAIN="drupal"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer ${TOKEN}" \
-X POST -d '{
"authorized_users": [
"user1",
"user2"
],
"backups_enabled": true,
"booted": true,
"image": "linode/ubuntu22.04",
"label": "drupal-server",
"private_ip": true,
"region": "us-southeast",
"root_pass": "${ROOT_PASS}",
"stackscript_data": {
"username": "${USERNAME}",
"password": "${PASSWORD}",
"soa_email_address": "${SOA_EMAIL_ADDRESS}",
"domain": "${DOMAIN}",
"subdomain": "${SUBDOMAIN}",
"disable_root": "Yes"
},
"stackscript_id": 00000000000,
"type": "g6-nanode-1"
}' https://api.linode.com/v4/linode/instances

CLI:
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export USERNAME="admin"
export PASSWORD="aComplexP@ssword"
export DOMAIN="example.com"
export SUBDOMAIN="drupal"

linode-cli linodes create \
--image 'linode/ubuntu22.04' \
--label drupal-server \
--root_pass ${ROOT_PASS} \
--booted true \
--stackscript_id 00000000000 \
--stackscript_data '{"username": "${USERNAME}","disable_root":"Yes","token_password":"${TOKEN_PASSWORD}","subdomain":"${SUBDOMAIN}","domain":"${DOMAIN}","soa_email_address":"${SOA_EMAIL_ADDRESS}"}'
--region us-east \
--type g6-nanode-1 \
--authorized_keys "ssh-rsa AAAA_valid_public_ssh_key_123456785== user@their-computer"
--authorized_users "user1"
--authorized_users "user2"
```
## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript reference](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
- [Drupal Documentation](https://www.drupal.org/docs)
- [Drupal Security Updates](https://www.drupal.org/security)