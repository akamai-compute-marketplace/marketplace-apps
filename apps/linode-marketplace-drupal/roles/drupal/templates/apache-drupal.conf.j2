<VirtualHost *:80>
    ServerAdmin webmaster@{{ ansible_fqdn }}
    DocumentRoot /var/www/drupal/web
    ServerName {{ ansible_fqdn }}
    ServerAlias www.{{ ansible_fqdn }}

    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin webmaster@{{ ansible_fqdn }}
    DocumentRoot /var/www/drupal/web
    ServerName {{ ansible_fqdn }}
    ServerAlias www.{{ ansible_fqdn }}

    <Directory /var/www/drupal/web>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        RewriteEngine on
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !=/favicon.ico
        RewriteRule ^ index.php [L]
    </Directory>

    ErrorLog /var/log/apache2/drupal-error.log
    CustomLog /var/log/apache2/drupal-access.log combined
</VirtualHost>