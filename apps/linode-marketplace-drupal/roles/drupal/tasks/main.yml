---
# Main Drupal installation tasks
- name: Import MariaDB tasks
  import_tasks: mariadb.yml

- name: Import PHP tasks
  import_tasks: php.yml

- name: Import Apache tasks
  import_tasks: apache.yml

# Install Drupal
- name: Download Drupal
  get_url:
    url: https://www.drupal.org/download-latest/tar.gz
    dest: /tmp/drupal.tar.gz

- name: Create Drupal directory
  file:
    path: /var/www/drupal
    state: directory
    owner: www-data
    group: www-data

- name: Extract Drupal
  unarchive:
    src: /tmp/drupal.tar.gz
    dest: /var/www/
    remote_src: yes
    extra_opts: ["--strip-components=1"]
    owner: www-data
    group: www-data

- name: Create files directory
  file:
    path: /var/www/drupal/sites/default/files
    state: directory
    mode: '0755'
    owner: www-data
    group: www-data

- name: Copy default settings file
  copy:
    src: /var/www/drupal/sites/default/default.settings.php
    dest: /var/www/drupal/sites/default/settings.php
    remote_src: yes
    owner: www-data
    group: www-data
    mode: '0644'

- name: Install Composer
  shell: |
    curl -sS https://getcomposer.org/installer | php
    mv composer.phar /usr/local/bin/composer
  args:
    creates: /usr/local/bin/composer

- name: Install Drush via Composer
  composer:
    command: require
    global_command: yes
    arguments: drush/drush 