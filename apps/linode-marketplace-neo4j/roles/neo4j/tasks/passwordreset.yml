---
- name: Disabling authentication for password reset
  lineinfile:
    path: "{{ neo4j_config }}"
    regexp: '^\#dbms.security.auth_enabled'
    line: "dbms.security.auth_enabled=false"
    state: present

- name: Restarting neo4j service
  systemd_service:
    name: neo4j
    state: restarted

- name: Update neo4j password
  command:
    cmd: |
      echo "ALTER CURRENT USER SET PASSWORD FROM 'neo4j' \ 
      to '{{ neo4j_password }}'" | cypher_shell -d system

- name: Enabling authentication
  lineinfile:
    path: "{{ neo4j_config }}"
    regexp: '^dbms.security.auth_enabled'
    line: "dbms.security.auth_enabled=true"
    state: present

- name: Restarting neo4j service
  systemd_service:
    name: neo4j
    state: restarted
    enabled: true