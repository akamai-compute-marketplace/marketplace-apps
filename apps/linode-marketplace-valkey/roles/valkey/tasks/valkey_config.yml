---
## configure valkey

- name: create valkey directory tree
  file:
    path: '{{ item }}'
    state: directory
  loop:
    - '/etc/valkey/'
    - '/var/valkey/'

- name: copy config file
  copy:
    src: files/valkey.conf
    dest: /etc/valkey/valkey.conf

- name: start disable THP
  systemd: 
    name: disable-thp.service
    state: started
    enabled: true
    daemon-reload: true

- name: start valkey
  systemd: 
    name: valkey.service
    state: started
    enabled: true