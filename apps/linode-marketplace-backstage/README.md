# Akamai Compute Backstage Deployment One-Click APP

Backstage is an open-source platform for building developer portals, designed to simplify and unify software development processes. It provides a centralized hub for managing services, tools, and documentation, enabling teams to improve efficiency, collaboration, and scalability across projects.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| Backstage    | Latest    | Platform for building developer portals |
| Postgresql | 16.6 | Database management system | 
| Yarn | 4.4.1 | Package manager for Javascript projects | 
| NVM | latest | Node Version Manager to manage multiple versions of node on system | 


**Supported Distributions:**

- Ubuntu 24.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |
| Docker | Installs the latest version of Docker Community Edition. |

## Use our API

Customers can choose to the deploy the Backstage app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- TOKEN
- ROOT_PASS
- USERNAME
- SOA_EMAIL_ADDRESS
- SUBDOMAIN
- DOMAIN
- ALLOW_IPS
- APP_NAME
- GITHUB_OAUTH_CLIENT_ID
- GITHUB_OAUTH_CLIENT_SECRET
- GITHUB_USERNAME
- GITHUB_PAT
- BACKSTAGE_ORGNAME

SHELL:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"
export SOA_EMAIL_ADDRESS="email@domain.com"
export SUBDOMAIN=backstage-app""
export DOMAIN="example.com"
export ALLOW_IPS=""
export APP_NAME="backstage-app"
export GITHUB_OAUTH_CLIENT_ID=""
export GITHUB_OAUTH_CLIENT_SECRET=""
export GITHUB_USERNAME=""
export GITHUB_PAT=""
export BACKSTAGE_ORGNAME="Akamai Technologies"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "image": "linode/ubuntu24.04",
    "private_ip": true,
    "region": "us-mia",
    "stackscript_data": {
        "user_name": "${USERNAME}",
        "disable_root": "No",
        "token_password": "${TOKEN}",
        "subdomain": "${SUBDOMAIN}",
        "domain": "${DOMAIN}",
        "soa_email_address": "${SOA_EMAIL_ADDRESS}",
        "allowed_ips": "${ALLOW_IPS}",
        "app_name": "${APP_NAME}",
        "github_oauth_client_id": "${GITHUB_OAUTH_CLIENT_ID}",
        "github_oauth_client_secret": "$GITHUB_OAUTH_CLIENT_SECRET",
        "github_username": "$GITHUB_USERNAME",
        "backstage_orgname": "${BACKSTAGE_ORGNAME}",
        "github_pat": "${GITHUB_PAT}"
    },
    "stackscript_id": 000000,
    "type": "g6-dedicated-4",
    "label": "backstage-server",
    "root_pass": "${ROOT_PASS}",
    "authorized_users": [
        "user1"
    ],
    "disk_encryption": "enabled"
}' https://api.linode.com/v4/linode/instances
```

CLI:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"
export SOA_EMAIL_ADDRESS="email@example.com"
export SUBDOMAIN=backstage-app""
export DOMAIN="example.com"
export ALLOW_IPS=""
export APP_NAME="backstage-app"
export GITHUB_OAUTH_CLIENT_ID=""
export GITHUB_OAUTH_CLIENT_SECRET=""
export GITHUB_USERNAME=""
export GITHUB_PAT=""
export BACKSTAGE_ORGNAME="Akamai Technologies"

linode-cli linodes create \
  --image 'linode/ubuntu24.04' \
  --private_ip true \
  --region us-mia \
  --stackscript_data '{"user_name": "{USERNAME}","disable_root":"No","token_password":"${TOKEN}","subdomain":"${SUBDOMAIN}","domain":"${DOMAIN}","soa_email_address":"${SOA_EMAIL_ADDRESS}","allowed_ips":"${ALLOW_IPS}","app_name":"${APP_NAME}","github_oauth_client_id":"${GITHUB_OAUTH_CLIENT_ID}","github_oauth_client_secret":"${GITHUB_OAUTH_CLIENT_SECRET}","github_username":"${GITHUB_USERNAME}","backstage_orgname":"${BACKSTAGE_ORGNAME}","github_pat":"${GITHUB_PAT}"}' \
  --stackscript_id 000000 \
  --type g6-dedicated-4 \
  --label backstage-server \
  --root_pass ${ROOT_PASS} \
  --authorized_users user1 \
  --disk_encryption enabled
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
- [Backstage - Getting Started](https://backstage.io/docs/getting-started/)
- [Backstage - Create Github Oauth App](https://backstage.io/docs/getting-started/config/authentication/)