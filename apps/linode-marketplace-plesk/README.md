# Linode Plesk Deployment One-Click APP

Plesk is the leading secure WordPress and website management platform. This Ansible playbook installs the latest publicly available Plesk, activates a trial license, installs essential extensions, and sets up and configures the firewall. Please allow the script around 15 minutes to finish.

## Software Included

| Software       | Version   | Description   |
| :---           | :----     | :---          |
| Dovecot        | 2.3       | An open-source IMAP and POP3 email server for Linux/UNIX-like systems, known for its performance and security. |
| nginx          | 1.24      | A high-performance web server, reverse proxy, and HTTP cache, widely used for its efficiency, stability, and low resource consumption. |
| PHP            | 8.3       | A popular general-purpose scripting language especially suited to web development, fast, flexible and pragmatic. |
| phpMyAdmin     | 5.2       | A free and open-source administration tool for MySQL and MariaDB databases, accessible via a web browser. |
| Plesk Obsidian | Latest    | A commercial web hosting and server data center automation software with a control panel that allows a server administrator to set up new websites, reseller accounts, email accounts, and DNS entries through a web-based interface. |
| Postfix        | 3.5       | A free and open-source mail transfer agent (MTA) that routes and delivers email over the Internet. |

**Supported Distributions:**

- Ubuntu 22.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to the deploy the plesk app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- TOKEN
- ROOT_PASS

SHELL:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export DISABLE_ROOT="Yes or No"
export USER_NAME="username"

curl -H "Content-Type: application/json" \
    -H "Authorization: Bearer ${TOKEN}" \
    -X POST -d '{
      "backups_enabled": true,
      "swap_size": 512,
      "image": "linode/ubuntu2204",
      "root_pass": "${ROOT_PASS}",
      "stackscript_id": 00000000000,
      "stackscript_data": {
        '{"disable_root": "${DISABLE_ROOT}", 
        "user_name":"${USER_NAME}",
        "soa_email_address": "${SOA_EMAIL_ADDRESS}"}'
      },
      "authorized_users": [
        "myUser",
        "secondaryUser"
      ],
      "booted": true,
      "label": "linode123",
      "type": "g6-standard-2",
      "region": "us-east",
      "group": "Linode-Group"
    }' \
https://api.linode.com/v4/linode/instances
```

CLI:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export DISABLE_ROOT="Yes or No"
export USER_NAME="username"

linode-cli linodes create \
  --label linode123 \
  --root_pass ${ROOT_PASS} \
  --booted true \
  --stackscript_id 00000000000 \
  --stackscript_data '{"disable_root": "${DISABLE_ROOT}", "user_name":"${USER_NAME}", "soa_email_address": "${SOA_EMAIL_ADDRESS}"}' \
  --region us-east \
  --type g6-standard-2 \
  --authorized_keys "ssh-rsa AAAA_valid_public_ssh_key_123456785== user@their-computer"
  --authorized_users "myUser"
  --authorized_users "secondaryUser"
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
