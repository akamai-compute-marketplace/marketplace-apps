---
- name: Install required build and Python dependencies
  ansible.builtin.apt:
    name:
      - build-essential
      - libssl-dev
      - libffi-dev
      - python3-dev
      - python3-pip
      - python3-venv
    state: present
    update_cache: yes

- name: Create airflow system user
  user:
    name: airflow
    home: /opt/airflow
    shell: /bin/bash
    system: yes
    create_home: yes

- name: Add airflow user to sudo group
  user:
    name: airflow
    groups: sudo
    append: yes