# Linode Secure Your Server Deployment One-Click APP

Performs simple server hardening. Optional settings include disabling root SSH connections, adding a sudo user, basic firewall and fail2ban.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| UFW | latest | Uncomplicated Firewall. Debian wrapper for iptables |
| Fail2Ban | latest | SSH jail for brute force prevention |

**Supported Distributions:**

- Ubuntu 22.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to the deploy the Secure Your Server app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

SHELL:
```
curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "image": "linode/ubuntu22.04",
    "region": "us-ord",
    "type": "g6-standard-1",
    "label": "secure-your-server-oca-us-ord",
    "tags": [],
    "root_pass": "A_Really_Great_Password",
    "authorized_users": [
        "user1",
        "user2"
    ],
    "booted": true,
    "backups_enabled": false,
    "private_ip": false,
    "stackscript_id": 00000,
    "stackscript_data": {
        "disable_root": "No",
        "soa_email_address": "email@domain.tld",
        "user_name": "sudo_user",
        "password": "AReallyGreatPassword",
        "pubkey": "ssh-rsa AAAA_valid_public_ssh_key_123456785== user@their-computer",
        "token_password": "A_Valid_API_Token",
        "subdomain": "examplesubdomain",
        "domain": "domain.tld"
    }
}' https://api.linode.com/v4/linode/instances
```
CLI:
```
linode-cli linodes create \
  --image 'linode/ubuntu22.04' \
  --region us-southeast \
  --type g6-standard-1 \
  --label secure-your-server-oca-us-southeast \
  --root_pass A_Really_Great_Password \
  --authorized_users user1 \
  --authorized_users user2 \
  --booted true \
  --backups_enabled false \
  --private_ip false \
  --stackscript_id 000000 \
  --stackscript_data '{"disable_root": "No","soa_email_address":"email@domain.tld","user_name":"sudo_user","password":"AReallyGreatPassword","pubkey":"ssh-rsa AAAA_valid_public_ssh_key_123456785== user@their-computer","token_password":"A_Valid_API_Token","subdomain":"examplesubdomain","domain":"domain.tld"}'
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
