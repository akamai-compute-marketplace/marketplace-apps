---
- name: set sudo user
  user:
        name: "{{ username }}"
        shell: /bin/bash
        groups: sudo
        password: "{{ password | password_hash('sha512') }}"
        update_password: on_create
        expires: -1
        append: yes
        generate_ssh_key: yes
        ssh_key_bits: 4096
        ssh_key_file: .ssh/id_rsa
        state: present
        
- name: Disable root login
  block:
  - name: Set PermitRootLogin
    lineinfile:
      path: "/etc/ssh/sshd_config"
      regexp: "^PermitRootLogin"
      line: "PermitRootLogin no"
  - name: Restart SSH
    service:
      name: sshd
      state: restarted
  when: disable_root == True

