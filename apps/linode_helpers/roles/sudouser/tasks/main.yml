---
- name: set sudo user
  user:
        name: "{{ username }}"
        shell: /bin/bash
        groups: sudo
        password: "{{ password | password_hash('sha512') }}"
        update_password: on_create
        expires: -1
        append: yes
        generate_ssh_key: yes
        ssh_key_bits: 4096
        ssh_key_file: .ssh/id_rsa
        state: present
        
- name: Disable root login
  lineinfile:
    path: "{{ sshd_config_file }}"
    regexp: "^PermitRootLogin"
    line: "PermitRootLogin no"
    backup: yes
  notify: restart sshd
  when: disable_root == True