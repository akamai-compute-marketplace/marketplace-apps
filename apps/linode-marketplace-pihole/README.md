# Akamai Compute Pi-hole Deployment One-Click APP

Pi-hole is a DNS sinkhole that filters out requests to ad-serving domains, blocking ads and improving network performance. With Pi-hole, you can actively monitor every DNS request made on your network and block requests as they come in.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| pihole   | latest   | DNS sinkhole |
| nginx   | latest   | Web service |


**Supported Distributions:**

- Ubuntu 24.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to the deploy the Pi-hole through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- ROOT_PASS
- USERNAME


SHELL:
```
export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "image": "linode/ubuntu24.04",
    "private_ip": true,
    "region": "us-mia",
    "stackscript_data": {
        "user_name": "${USERNAME}"
    },
    "stackscript_id": 970522,
    "type": "g6-dedicated-4",
    "label": "pihole-server",
    "root_pass": "${ROOT_PASS}",
    "authorized_users": [
        "user1"
    ],
    "disk_encryption": "enabled"
}' https://api.linode.com/v4/linode/instances
```

CLI:
```

export ROOT_PASS="aComplexP@ssword"
export USERNAME="user1"

linode-cli linodes create \
  --image 'linode/ubuntu24.04' \
  --private_ip true \
  --region us-mia \
  --stackscript_data '{"user_name": "{USERNAME}" \
  --stackscript_id 970522 \
  --type g6-dedicated-4 \
  --label pihole-server \
  --root_pass ${ROOT_PASS} \
  --authorized_users user1 \
  --disk_encryption enabled
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
- [Pi-Hole](https://pi-hole.net/)
