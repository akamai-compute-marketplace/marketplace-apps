---
- name: Create Milvus directory
  file:
    path: /opt/milvus
    state: directory
    mode: "0755"

- name: Deploy Milvus templates
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "0644"
  loop:
    - src: milvus.yaml
      dest: /opt/milvus/milvus.yaml
    - src: cpu-docker-compose.yml.j2
      dest: /opt/milvus/docker-compose.yml
    - src: env.j2
      dest: /opt/milvus/.env
  
- name: Pull Milvus Docker image
  community.docker.docker_compose_v2:
    project_src: /opt/milvus
    pull: always

- name: Start Milvus Compose file
  community.docker.docker_compose_v2:
    project_src: /opt/milvus
    state: present