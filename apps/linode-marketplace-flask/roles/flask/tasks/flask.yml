---
- name: Ensure Flask app directory exists
  file:
    path: /var/www/flask_project
    state: directory
    owner: www-data
    group: www-data
    mode: '0755'

- name: Create Flask app subdirectories
  file:
    path: "/var/www/flask_project/static"
    state: directory
    owner: www-data
    group: www-data
    mode: '0755'

- name: Create virtual environment
  pip:
    name: Flask
    virtualenv: /var/www/flask_project/venv
    virtualenv_command: "{{ ansible_python_interpreter }} -m venv"
    state: present

- name: Set virtualenv permissions
  file:
    path: /var/www/flask_project/venv
    state: directory
    owner: www-data
    group: www-data
    recurse: yes

- name: Install Flask in virtual environment
  pip:
    name: Flask
    virtualenv: /var/www/flask_project/venv
    state: present
