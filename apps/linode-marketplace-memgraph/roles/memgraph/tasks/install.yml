---
- name: Set Ubuntu distribution version
  set_fact:
    distribution_version: "{{ ansible_facts['distribution_version'] }}"

- name: Fetching the latest Memgraph version
  uri:
    url: https://api.github.com/repos/memgraph/memgraph/releases/latest
    return_content: true
    status_code: 200
    body_format: json
  register: release_tag

- name: Setting the latest Memgraph version
  set_fact:
    memgraph_version: "{{ release_tag.json.tag_name[1:] }}"

# Future proof. Contains fallback OS.
- name: Installing Memgraph...
  block:
    - name: Installing Memgraph for {{ distribution_version }}
      apt:
        deb: "https://download.memgraph.com/memgraph/v{{ memgraph_version }}/ubuntu-{{ distribution_version }}/memgraph_{{ memgraph_version }}-1_amd64.deb"
  rescue:
    - name: Installing Memgraph for Ubuntu 24.04
      apt:
        deb: "https://download.memgraph.com/memgraph/v{{ memgraph_version }}/ubuntu-24.04/memgraph_{{ memgraph_version }}-1_amd64.deb"    

- name: Stopping Memgraph service
  systemd_service:
    name: memgraph
    state: stopped
