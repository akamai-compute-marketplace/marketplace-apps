---
- name: Configure Memgraph on localhost for password reset
  lineinfile:
    path: "{{ memgraph_config }}"
    regexp: "^# --bolt-address=0.0.0.0"
    line: "--bolt-address=127.0.0.1"
    state: present
  notify: Restart memgraph

- name: Start Memgraph
  systemd_service:
    name: memgraph
    state: started

- name: Wait for Memgraph to start
  wait_for:
    host: localhost
    port: 7687
    timeout: 30

- name: Creating Memgraph username
  shell:
    cmd: |
      set -o pipefail
      echo "CREATE USER {{ memgraph_username }} IDENTIFIED BY '{{ memgraph_password }}';" | mgconsole
    executable: /bin/bash
  no_log: true
