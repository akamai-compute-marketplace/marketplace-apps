# Linode Openbao Deployment One-Click APP

OpenBao is an open source solution to manage, store, and distribute sensitive data including secrets, certificates, and keys. This project is a forked alternative to Vault managed by the Linux Foundation, and development is driven by the community. 

* Warning: While Openbao is a fork of a production ready 1.14.x release of Hashicorp Vault, the Openbao codebase is still early in development and is subject to change as development takes place, we recommend following the [release cycles](https://github.com/openbao/openbao/releases) for any breaking changes to minimize any downtime on a production enviornment *

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| Openbao    | v2.0.2    | Secrets Management tool |


**Supported Distributions:**

- Ubuntu 24.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to the deploy the Openbao app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following values are updated at the top of the code block before running the commands:
- TOKEN
- ROOT_PASS

SHELL:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SUDO_USER="admin"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "authorized_users": [
        "user1"
    ],
    "backups_enabled": false,
    "booted": true,
    "image": "linode/ubuntu24.04",
    "label": "openbao",
    "private_ip": false,
    "region": "us-southeast",
    "root_pass": "${ROOT_PASS}",
    "stackscript_data": {
        "disable_root": "No",
        "sslheader": "Yes",
        "user_name": "${SUDO_USER}",
        "token_password": "${{TOKEN}}",
        "country_name": "US",
        "state_or_province_name": "pennsylvania",
        "locality_name": "philadelphia",
        "organization_name": "akamai",
        "email_address": "user@domain.tld",
        "client_ips": "192.168.1.2, 192.168.1.3",
        "soa_email_address": "user@domain.tld"
    },
    "stackscript_id": 0000000,
    "tags": [
        "openbao"
    ],
    "type": "g6-dedicated-4"
}' https://api.linode.com/v4/linode/instances
```

CLI:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SUDO_USER="admin"

linode-cli linodes create \
  --backups_enabled true \
  --booted true \
  --image 'linode/ubuntu24.04' \
  --label openbao \
  --private_ip true \
  --region us-ord \
  --root_pass "${ROOT_PASS}" \
  --stackscript_data '{"disable_root": "No","sslheader":"Yes","user_name":"${SUDO_USER}","token_password":"${TOKEN}","country_name":"US","state_or_province_name":"pennsylvania","locality_name":"philadelphia","organization_name":"akamai","email_address":"user@domain.tld","client_ips":"192.168.1.2, 192.168.1.3","soa_email_address":"user@domain.tld"}' \
  --stackscript_id 00000 \
  --type g6-dedicated-4
```


## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)

