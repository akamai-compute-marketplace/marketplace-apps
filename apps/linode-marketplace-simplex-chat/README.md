# Linode SimpleX Messaging Server Deployment One-Click APP

SimpleX Chat - The first messaging platform that has no user identifiers of any kind - 100% private by design. SMP server is the relay server used to pass messages in SimpleX network. XFTP is a new file transfer protocol focussed on meta-data protection. This One-Click APP will deploy both smp and xftp servers.

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| Docker    | 20.10    | Container Management tool |
| Docker-Compose  | 1.29   | Container Management tool |
| simplexchat/smp-server | Latest | smp server relay |
| simplexchat/xftp-server | Latest | xftp file transfer server |


**Supported Distributions:**

- Ubuntu 22.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |

## Use our API

Customers can choose to deploy SimpleX server through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment, and substitute for default values..

SHELL:
```sh
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"

export DOMAIN="example.org"
export SUBDOMAIN="smp"
export SMP_PASSWORD="123qwe"
export XFTP_QUOTA="10gb"

curl -H "Content-Type: application/json" \
    -H "Authorization: Bearer ${TOKEN}" \
    -X POST -d '{
      "backups_enabled": true,
      "swap_size": 512,
      "image": "linode/ubuntu2204",
      "root_pass": "${ROOT_PASS}",
      "stackscript_id": 00000000000,
      "stackscript_data": {
        "domain": "${DOMAIN}",
        "subdomain": "${SUBDOMAIN}",
        "smp_password" : "${SMP_PASSWORD}",
        "xftp_quota" : "${XFTP_QUOTA}"
      },
      "authorized_users": [
        "myUser",
        "secondaryUser"
      ],
      "booted": true,
      "label": "linode123",
      "type": "g6-standard-2",
      "region": "us-east",
      "group": "Linode-Group"
    }' \
https://api.linode.com/v4/linode/instances
```

CLI:
```sh
linode-cli linodes create \
  --image 'linode/ubuntu22.04' \
  --region us-southeast \
  --type g6-standard-1 \
  --label simplex-server \
  --root_pass A_Really_Great_Password \
  --authorized_users user1 \
  --authorized_users user2 \
  --booted true \
  --backups_enabled true \
  --private_ip false \
  --stackscript_id 000000 \
  --stackscript_data '{"disable_root":"No", "soa_email_address":"email@domain.tld", "user_name":"sudo_user", "password":"AReallyGreatPassword", "token_password":"A_Valid_API_Token", "subdomain":"smp", "domain":"example.org", "smp_password":"123qwe", "xftp_quota":"10gb"}'
```

## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)
