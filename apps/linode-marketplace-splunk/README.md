# Linode Splunk Deployment One-Click APP

Splunk is a powerful log analyzer that can be used to obtain insight into your infrastructure. Splunk collects, monitors, analyzes, and visualizes data from database applications, web servers, cloud networks, and a variety of other sources. 

## Software Included

| Software  | Version   | Description   |
| :---      | :----     | :---          |
| Splunk    | 9.1.2    | Application SIEM |
| Akamai SIEM | 1.4.19 | The sample Splunk connector is a Splunk add-on that captures security events from the ​Akamai​ Security Events Collector, which exposes a RESTful API that lets the connector pull events in JSON format. Akamai's Splunk add-on converts security event data from JSON into CIM format. The resulting data can then be imported into and analyzed by Splunk. |

**Supported Distributions:**

- Ubuntu 22.04 LTS

## Linode Helpers Included

| Name  | Action  |
| :---  | :---    |
| Hostname   | The Hostname module uses `dnsdomainname -A` to detect the Linode's FQDN and write to the `/etc/hosts` file. This defaults to the Linode's automatically assigned rDNS. To use a custom FQDN see [Configure your Linode for Reverse DNS](https://www.linode.com/docs/guides/configure-your-linode-for-reverse-dns/).  |
| Update Packages   | The Update Packages module performs apt update and upgrade actions as root.  |
| UFW   | The UFW module will utilize a list generated by `linode_helpers/ufw/ufwgen.yml` in the `group_vars/linode/vars` and enables the service.  |
| Fail2Ban   | The Fail2Ban module installs, activates and enables the Fail2Ban service.  |
| Certbot SSL   | Install a valid SSL certificate on the Splunk domain endpoint

## Use our API

Customers can choose to the deploy the Splunk app through the Linode Marketplace or directly using API. Before using the commands below, you will need to create an [API token](https://www.linode.com/docs/products/tools/linode-api/get-started/#create-an-api-token) or configure [linode-cli](https://www.linode.com/products/cli/) on an environment.

Make sure that the following UDF values are assigned before running the API commands. NOTE that if any of the Akamai SIEM UDFs are left blank the deployment will default to a base Splunk install.

SHELL:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export SPLUNK_USER="splunk_admin"
export ACCESS_TOKEN_PASSWORD="access_token_password"
export CLIENT_SECRET_PASSWORD="client_secret_password"
export CLIENT_TOKEN_PASSWORD="client_token_password"
export LUNA_HOSTNAME="luna_hostname"
export SECURITY_CONFIG_ID="security_config_id"

curl -H "Content-Type: application/json" \
-H "Authorization: Bearer $TOKEN" \
-X POST -d '{
    "authorized_users": [
        "user1",
        "user2"
    ],
    "backups_enabled": false,
    "booted": true,
    "image": "linode/ubuntu22.04",
    "label": "splunk-siem-oca-us-ord-001",
    "private_ip": false,
    "region": "us-ord",
    "root_pass": "${ROOT_PASS}",
    "stackscript_data": {
        "disable_root": "No",
        "user_name": "sudo_user",
        "soa_email_address": "${SOA_EMAIL_ADDRESS}",
        "splunk_user": "${SPLUNK_USER}",
        "access_token_password": "${ACCESS_TOKEN_PASSWORD}",
        "client_secret_password": "${CLIENT_SECRET_PASSWORD}",
        "client_token_password": "${CLIENT_TOKEN_PASSWORD}",
        "hostname": "${LUNA_HOSTNAME}",
        "security_config_id": "${SECURITY_CONFIG_ID}"
    },
    "stackscript_id": 0000000,
    "tags": [],
    "type": "g6-standard-2"
}' https://api.linode.com/v4/linode/instances
```
CLI:
```
export TOKEN="YOUR API TOKEN"
export ROOT_PASS="aComplexP@ssword"
export SOA_EMAIL_ADDRESS="email@domain.com"
export SPLUNK_USER="splunk_admin"
export ACCESS_TOKEN_PASSWORD="access_token_password"
export CLIENT_SECRET_PASSWORD="client_secret_password"
export CLIENT_TOKEN_PASSWORD="client_token_password"
export LUNA_HOSTNAME="luna_hostname"
export SECURITY_CONFIG_ID="security_config_id"

linode-cli linodes create \
  --authorized_users user1 \
  --authorized_users user2 \
  --backups_enabled false \
  --booted true \
  --image 'linode/ubuntu22.04' \
  --label splunk-siem-oca-us-ord-001 \
  --private_ip false \
  --region us-ord \
  --root_pass '${ROOT_PASS}' \
  --stackscript_data '{"disable_root": "No","user_name":"sudo_user","soa_email_address":"${SOA_EMAIL_ADDRESS}","splunk_user":"${SPLUNK_USER}","access_token_password":"${ACCESS_TOKEN_PASSWORD}","client_secret_password":"${CLIENT_SECRET_PASSWORD}","client_token_password":"'${CLIENT_TOKEN_PASSWORD}","hostname":"${LUNA_HOSTNAME}","security_config_id":"${SECURITY_CONFIG_ID"}' \
  --stackscript_id 0000000 \
  --type g6-standard-2```
```
## Resources

- [Create Linode via API](https://www.linode.com/docs/api/linode-instances/#linode-create)
- [Stackscript referece](https://www.linode.com/docs/guides/writing-scripts-for-use-with-linode-stackscripts-a-tutorial/#user-defined-fields-udfs)

