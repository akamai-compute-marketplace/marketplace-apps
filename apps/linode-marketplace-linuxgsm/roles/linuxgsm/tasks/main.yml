--- 

  - name: setup linuxgsm user dir
    block: 
    - name: create user 
      ansible.builtin.user: 
        name: linuxgsm
        shell: /bin/bash
        groups: sudo
        password: "{{ password | password_hash('sha512') }}"
        update_password: on_create
        expires: -1
        append: yes
        generate_ssh_key: no
        state: present
 

  - name: Install LinuxGSM server
    block:
    - name: download linuxgsm script
      ansible.builtin.get_url:
        url: https://linuxgsm.sh
        dest: /home/linuxgsm/linuxgsm.sh
        mode: -rwxr-xr-x

    - name: chown homedir
      ansible.builtin.file:
        path: /home/linuxgsm
        owner: linuxgsm
        recurse: yes
      tags: shell

    - name: run linuxgsm scripts
      become: true
      become_user: linuxgsm
      ansible.builtin.shell:
        chdir: /home/linuxgsm
        cmd: ./linuxgsm.sh
      register: gsm_out
      tags: shell

