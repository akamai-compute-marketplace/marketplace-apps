---
# aapanel ansible playbook
- name: Aapanel setup
  hosts: localhost
  connection: local
  gather_facts: true
  any_errors_fatal: true
  user: root
  vars_files: [group_vars/linode/vars]
  tasks:
    - name: Run roles on staging
      when: "mode == 'staging'"
      block:
        - name: Run roles
          include_role:
            name: "{{ item }}"
          loop: [common, aapanel, post]
        - name: Deployment passed
          import_tasks: ../linode_helpers/roles/cilog/tasks/main.yml
          vars:
            deploy_status: "successful"
      rescue:
        - name: Deployment failed
          import_tasks: ../linode_helpers/roles/cilog/tasks/main.yml
          vars:
            deploy_status: "failed"
    - name: Running app normally
      include_role:
        name: "{{ item }}"
      loop: [common, aapanel, post]
      when: "mode == 'production'"
